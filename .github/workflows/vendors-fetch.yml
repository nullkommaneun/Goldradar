name: vendors-fetch

on:
  schedule:
    - cron: "0 */2 * * *"   # alle 2h
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # WICHTIG: lxml auf 4.9.x pinnen, da extruct nicht mit lxml 5.x kompatibel ist
          pip install "lxml>=4.9.3,<5"
          pip install httpx[http2]==0.27.2 extruct==0.16.0
          # selectolax ist optional – nur falls du später HTML-Fallback brauchst:
          # pip install selectolax==0.3.20

      - name: Run vendors fetcher
        env:
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          python scripts/vendors_fetch.py

      - name: Commit data changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(data): update vendors_auto.json"
          file_pattern: data/vendors_auto.json
